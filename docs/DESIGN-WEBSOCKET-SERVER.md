# WebSocket 游戏服务器 - 设计文档

双人接红包游戏 WebSocket 服务端设计。

---

## 1. 架构

```
┌─────────────┐                    ┌─────────────────────────────┐                    ┌─────────────┐
│   设备 A    │◄──── WebSocket ───►│   后端游戏服务器             │◄──── WebSocket ───►│   设备 B    │
│  (客户端)   │    双向通信        │  ┌───────────────────────┐  │    双向通信        │  (客户端)   │
└─────────────┘                    │  │ 内存中的游戏房间       │  │                    └─────────────┘
                                   │  │ - 红包、分数、篮子位置  │  │
                                   │  │ - 倒计时、游戏状态     │  │
                                   │  └───────────────────────┘  │
                                   └─────────────────────────────┘
```

---

## 2. 游戏参数常量

| 常量 | 值 | 说明 |
|------|-----|------|
| `GAME_WIDTH` | 360 | 游戏区域宽度 |
| `GAME_HEIGHT` | 480 | 游戏区域高度 |
| `BASKET_WIDTH` | 56 | 篮子宽度 |
| `BASKET_HEIGHT` | 40 | 篮子高度 |
| `ENVELOPE_SIZE` | 40 | 红包边长 |
| `GAME_DURATION` | 30 | 单局时长（秒） |

---

## 3. 消息协议

### 客户端 → 服务端

| type | 说明 | 参数 |
|------|------|------|
| `create` | 创建房间 | — |
| `join` | 加入房间 | `roomId` |
| `start` | 开始游戏 | — |
| `basket` | 移动篮子 | `playerNum`, `x` |
| `restart` | 再来一局 | — |

### 服务端 → 客户端

| type | 说明 |
|------|------|
| `created` | 房间创建成功 |
| `joined` | 加入成功 |
| `player2_joined` | 对手已加入 |
| `game_started` | 游戏开始 |
| `state` | 游戏状态同步 |
| `player_left` | 玩家离开 |
| `error` | 错误 |

---

*详细实现见 `server/game-server.js` 与 `src/app/page.tsx`*
